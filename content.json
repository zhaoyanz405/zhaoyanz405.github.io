{"pages":[],"posts":[{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2020/04/26/hello-world/"},{"title":"MongoDB配置实践","text":"单台ubuntu实现mongodb副本集新建测试目录 123456mkdir /data/mongod/mkdir /data/mongod/db0 #存储mongodb实例1的数据库文件mkdir /data/mongod/db1 #存储mongodb实例2的数据库文件mkdir /data/mongod/db2 #存储mongodb实例3的数据库文件mkdir /data/mongod/logs #存储log文件mkdir /data/mongod/conf #mongodb启动配置文件 创建启动配置文件 12cd /data/mongod/confvi mongod0.conf 编辑内容： 1234567891011121314151617181920212223242526272829303132storage: dbPath: /data/mongod/db0# engine:# mmapv1:# wiredTiger:# where to write logging data.systemLog: destination: file logAppend: false path: /data/mongod/logs/mongod0.log# network interfacesnet: port: 27017 bindIp: 127.0.0.1# how the process runsprocessManagement: timeZoneInfo: /usr/share/zoneinfo pidFilePath: /data/mongod/mongod0.pidreplication: oplogSizeMB: 10240 replSetName: IDY secondaryIndexPrefetch: all#security:# keyFile: /data/mongod/keyfile.key# clusterAuthMode: keyFile# authorization: enabled 多台机器需要配置security项， 生成key后拷贝至其他机器，并在配置文件中制定keyfile位置 12openssl rand -base64 666 &gt; keyfile.keychmod 600 mongodb.key 启动多个mongodb实例 123mongod -f mongod0.confmongod -f mongod1.confmongod -f mongod2.conf 若无失败，则进入db shell 1mongo 127.0.0.1:27017 执行 12345678910111213141516171819202122232425262728config = { \"_id\": \"IDY\", \"version\": 1, \"members\": [ { \"_id\": 0, \"host\": \"127.0.0.1:27017\", \"arbiterOnly\": false, \"hidden\": false, \"priority\": 10 }, { \"_id\": 1, \"host\": \"127.0.0.1:27018\", \"arbiterOnly\": false, \"hidden\": false, \"priority\": 1 }, { \"_id\": 2, \"host\": \"127.0.0.1:27019\", \"arbiterOnly\": false, \"hidden\": false, \"priority\": 1 } ]}rs.initiate(config) 再次进入各个db查看结构是否更改 123IDY:PRIMARY&gt;IDY:SECONDARY&gt;IDY:SECONDARY&gt; 在PRIMARY中插入数据： 12345678910111213IDY:PRIMARY&gt; show dbsadmin 0.000GBconfig 0.000GBlocal 0.000GBtest 0.000GBIDY:PRIMARY&gt; use testswitched to db testIDY:PRIMARY&gt; db.test.find({})IDY:PRIMARY&gt; db.test.insert({'info': 'test'})WriteResult({ \"nInserted\" : 1 })IDY:PRIMARY&gt; db.test.find({}){ \"_id\" : ObjectId(\"5bd27eaaf52562fd198fc9a3\"), \"info\" : \"test\" }IDY:PRIMARY&gt; 在SECONDARY中查看数据： 出现错误，原因是副本集不允许读写 123456789101112131415161718192021IDY:SECONDARY&gt; show dbs2018-10-26T10:41:25.207+0800 E QUERY [js] Error: listDatabases failed:{ \"operationTime\" : Timestamp(1540521683, 1), \"ok\" : 0, \"errmsg\" : \"not master and slaveOk=false\", \"code\" : 13435, \"codeName\" : \"NotMasterNoSlaveOk\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1540521683, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } }} :_getErrorWithCode@src/mongo/shell/utils.js:25:13Mongo.prototype.getDBs@src/mongo/shell/mongo.js:67:1shellHelper.show@src/mongo/shell/utils.js:876:19shellHelper@src/mongo/shell/utils.js:766:15@(shellhelp2):1:1IDY:SECONDARY&gt; 执行rs.slaveOk()，启用读写，再次查看数据： 1234567891011IDY:SECONDARY&gt; rs.slaveOk()IDY:SECONDARY&gt; show dbsadmin 0.000GBconfig 0.000GBlocal 0.000GBtest 0.000GBIDY:SECONDARY&gt; use testswitched to db testIDY:SECONDARY&gt; db.test.find({}){ \"_id\" : ObjectId(\"5bd27eaaf52562fd198fc9a3\"), \"info\" : \"test\" }IDY:SECONDARY&gt; 升级： 使用service管理mongod进程编辑service文件tips: service文件位置 ubuntu: /lib/systemd/system/mongod.service centos: /var/lib/systemd/system/mongod.service 拷贝编辑service文件与mongod进程对应 12345678910111213141516171819202122232425262728293031323334[Unit]Description=MongoDB Database ServerAfter=network.targetDocumentation=https://docs.mongodb.org/manual[Service]User=rootGroup=rootEnvironmentFile=-/etc/default/mongodExecStart=/usr/bin/mongod --config /data/mongod/conf/mongod0.confPermissionsStartOnly=truePIDFile=/data/monogd/mongod0.pidType=forking# file sizeLimitFSIZE=infinity# cpu timeLimitCPU=infinity# virtual memory sizeLimitAS=infinity# open filesLimitNOFILE=64000# processes/threadsLimitNPROC=64000# locked memoryLimitMEMLOCK=infinity# total threads (user+kernel)TasksMax=infinityTasksAccounting=false# Recommended limits for for mongod as specified in# http://docs.mongodb.org/manual/reference/ulimit/#recommended-settings[Install]WantedBy=multi-user.target 1234root@zhaoy-YangTianM4000e-07:/data/mongod/conf# ll /lib/systemd/system/mongod*-rw-r--r-- 1 root root 749 10月 26 10:52 /lib/systemd/system/mongod0.service-rw-r--r-- 1 root root 749 10月 26 10:57 /lib/systemd/system/mongod1.service-rw-r--r-- 1 root root 749 10月 26 10:57 /lib/systemd/system/mongod2.service","link":"/2020/04/26/MongoDB%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/"}],"tags":[{"name":"MongoDB","slug":"MongoDB","link":"/tags/MongoDB/"}],"categories":[]}